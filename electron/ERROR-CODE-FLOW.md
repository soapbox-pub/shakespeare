# Error Code Preservation Flow

## Before the Fix âŒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         RENDERER PROCESS                         â”‚
â”‚                                                                  â”‚
â”‚  ElectronFSAdapter.stat('/projects/untitled')                   â”‚
â”‚         â”‚                                                        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â–º IPC Call: fs:stat                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ IPC Channel
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MAIN PROCESS                            â”‚
â”‚                                                                  â”‚
â”‚  IPC Handler receives: '/projects/untitled'                     â”‚
â”‚         â”‚                                                        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â–º fs.stat('/home/user/shakespeare/projects/...')â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚                  âŒ ENOENT Error                                 â”‚
â”‚                  {                                               â”‚
â”‚                    message: "ENOENT: no such file...",          â”‚
â”‚                    code: 'ENOENT'  â† Non-enumerable!            â”‚
â”‚                  }                                               â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â–º Throw error                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ IPC Serialization (loses code!)
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         RENDERER PROCESS                         â”‚
â”‚                                                                  â”‚
â”‚  Error received:                                                 â”‚
â”‚  {                                                               â”‚
â”‚    message: "Error invoking remote method 'fs:stat': ...",      â”‚
â”‚    code: undefined  â† LOST!                                      â”‚
â”‚  }                                                               â”‚
â”‚         â”‚                                                        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â–º isomorphic-git checks: err.code === 'ENOENT'  â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚                  âŒ FALSE (code is undefined)                    â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â–º Throws unhandled error       â”‚
â”‚                                    ğŸ’¥ PROJECT CREATION FAILS    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## After the Fix âœ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         RENDERER PROCESS                         â”‚
â”‚                                                                  â”‚
â”‚  ElectronFSAdapter.stat('/projects/untitled')                   â”‚
â”‚         â”‚                                                        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â–º IPC Call: fs:stat                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ IPC Channel
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          MAIN PROCESS                            â”‚
â”‚                                                                  â”‚
â”‚  IPC Handler receives: '/projects/untitled'                     â”‚
â”‚         â”‚                                                        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â–º fs.stat('/home/user/shakespeare/projects/...')â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚                  âŒ ENOENT Error                                 â”‚
â”‚                  {                                               â”‚
â”‚                    message: "ENOENT: no such file...",          â”‚
â”‚                    code: 'ENOENT'                                â”‚
â”‚                  }                                               â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â–º Catch & Re-throw             â”‚
â”‚                                                                  â”‚
â”‚  âœ… FIX #1: Make code enumerable                                â”‚
â”‚  Object.defineProperty(err, 'code', {                           â”‚
â”‚    value: error.code,                                           â”‚
â”‚    enumerable: true  â† Survives IPC!                            â”‚
â”‚  })                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ IPC Serialization (preserves code!)
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         RENDERER PROCESS                         â”‚
â”‚                                                                  â”‚
â”‚  Error received:                                                 â”‚
â”‚  {                                                               â”‚
â”‚    message: "Error invoking remote method 'fs:stat': ...",      â”‚
â”‚    code: 'ENOENT'  â† PRESERVED! âœ…                               â”‚
â”‚  }                                                               â”‚
â”‚         â”‚                                                        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â–º âœ… FIX #2: unwrapElectronError()               â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚                  Extract code from error                         â”‚
â”‚                  Create new error with code property             â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â–º Return to caller             â”‚
â”‚                                                                  â”‚
â”‚  isomorphic-git checks: err.code === 'ENOENT'                   â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â–¼                                      â”‚
â”‚                  âœ… TRUE (code preserved!)                       â”‚
â”‚                           â”‚                                      â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â–º Returns false                â”‚
â”‚                                    âœ… PROJECT CREATION SUCCEEDS â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Points

1. **Problem**: Error `code` property is non-enumerable by default and gets lost during IPC serialization

2. **Fix #1 (Main Process)**: Use `Object.defineProperty()` with `enumerable: true` to make the code property survive IPC

3. **Fix #2 (Renderer Process)**: Unwrap Electron's error wrapping and extract the code property (or parse from message as fallback)

4. **Result**: isomorphic-git's `FileSystem.exists()` method can properly detect ENOENT errors and return `false` instead of throwing
